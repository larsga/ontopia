<?xml version="1.0"?>
<assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 http://maven.apache.org/xsd/assembly-1.1.2.xsd">
	<id>ontopia-dist</id>
	
	<formats>
		<format>dir</format>
	</formats>

	<includeBaseDirectory>false</includeBaseDirectory>
	
	<fileSets>
		<!-- Move tomcat to the correct location -->
		<fileSet>
			<directory>target/apache-tomcat-6.0.32/apache-tomcat-6.0.32</directory>
			<outputDirectory>apache-tomcat</outputDirectory>
			<excludes>
				<!-- exclude the default webapps -->
				<exclude>webapps/**</exclude>
				
				<!-- exclude all runnable files, copied later with correct mods -->
				<exclude>bin/*.sh</exclude>
				
				<!-- exclude catalina.bat and setclasspath.bat, is replaced later -->
				<exclude>bin/catalina.bat</exclude>
				<exclude>bin/setclasspath.bat</exclude>
				
				<!-- exclude server.xml, catalina.properties -->
				<!--
					Disabled because this is a tomcat 5 
					<exclude>conf/server.xml</exclude>
				-->
				<exclude>conf/catalina.properties</exclude>
			</excludes>
		</fileSet>
		
		<!-- chmod runnable files -->
		<fileSet>
			<directory>target/apache-tomcat-6.0.32/apache-tomcat-6.0.32/bin</directory>
			<outputDirectory>apache-tomcat/bin</outputDirectory>
			<fileMode>0755</fileMode>
			<includes>
				<include>*.sh</include>
			</includes>
			
			<!-- except catalina.sh, is replaced later -->
			<excludes>
				<exclude>catalina.sh</exclude>
			</excludes>
		</fileSet>
			
		<!-- copy modified configuration to distribution -->
		<fileSet>
			<directory>src/main/assembly/resources/</directory>
			<outputDirectory>.</outputDirectory>
			<fileMode>0644</fileMode>
			<excludes>
				<exclude>apache-tomcat/bin/*.sh</exclude>
			</excludes>
		</fileSet>
		
		<!-- copy modified startup items to distribution -->
		<fileSet>
			<directory>src/main/assembly/resources/apache-tomcat/bin/</directory>
			<outputDirectory>apache-tomcat/bin</outputDirectory>
			<fileMode>0755</fileMode>
			<includes>
				<include>*.sh</include>
			</includes>
		</fileSet>
	</fileSets>

	<dependencySets>
		<dependencySet>
			<outputDirectory>apache-tomcat/lib/ontopia</outputDirectory>
			<excludes>
				<exclude>*:war:*</exclude>
			</excludes>
		</dependencySet>
		
		<!-- add ROOT webapp -->
		<dependencySet>
			<includes><include>*:webapp-root:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>ROOT.war</outputFileNameMapping>
		</dependencySet>
		
		<!-- add accessctl webapp -->
		<dependencySet>
			<includes><include>*:webapp-accessctl:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>accessctl.war</outputFileNameMapping>
		</dependencySet>
		
		<!-- add xmltools webapp -->
		<dependencySet>
			<includes><include>*:webapp-xmltools:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>xmltools.war</outputFileNameMapping>
		</dependencySet>
		
		<!-- add i18n webapp -->
		<dependencySet>
			<includes><include>*:webapp-i18n:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>i18n.war</outputFileNameMapping>
		</dependencySet>
		
		<!-- add omnigator -->
		<dependencySet>
			<includes><include>*:webapp-omnigator:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>omnigator.war</outputFileNameMapping>
		</dependencySet>
		
		<!-- add ontopoly -->
		<dependencySet>
			<includes><include>*:webapp-ontopoly:war</include></includes>
			<outputDirectory>apache-tomcat/webapps/</outputDirectory>
			<outputFileNameMapping>ontopoly.war</outputFileNameMapping>
		</dependencySet>
	</dependencySets>
	
</assembly>
